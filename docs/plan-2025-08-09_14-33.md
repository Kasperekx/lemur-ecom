# Plan: Przyspieszenie pierwszego ładowania

**Timestamp**: 2025-08-09_14-33

## Diagnoza (symptomy i źródła opóźnień)

- Layout (`src/app/layout.tsx`) blokuje odpowiedź, bo pobiera:
  - `getWordpressMenuItems()` bez cache (cache: 'no-cache')
  - `getProducts()` (WooCommerce, brak cache) – ciężki payload
- Strona główna (`src/app/page.tsx`) ponownie pobiera:
  - `getProducts()` (duplikat względem layoutu)
  - `getLatestBlogPosts()` z revalidate: 1 (bardzo częste odświeżanie)
- Obrazy o wysokim priorytecie:
  - `HeroSection` – duży `priority` obraz (OK, ale ciężki)
  - `AboutSection` – obraz z Unsplash także z `priority` (niepotrzebne)
- Wiele komponentów klienckich nad „foldem” (Framer Motion) zwiększa koszt hydracji.
- `blog/page.tsx` pobiera wpisy po stronie klienta (nie blokuje TTFB na home, ale wpływa na UX tej podstrony).

## Cele (KPI)

- Obniżyć TTFB i FCP na stronie głównej o >= 40%.
- Zmniejszyć liczbę requestów WordPress/WooCommerce przy pierwszym wejściu do 1 (z 2+).
- Zredukować rozmiar początkowego payloadu obrazów o >= 30%.

## Plan działań (minimalne, wysokowartościowe zmiany)

1. Usuń pobieranie produktów z layoutu i przekaż do `Navbar` tylko pozycje menu.

   - Wyszukiwanie produktów w nawigacji przenieś na żądanie (API route + zapytanie po wpisaniu frazy).
   - Efekt: brak ciężkiego `getProducts()` w layoutcie i brak duplikacji na home.

2. Dodaj cache/ISR do WooCommerce i WordPress:

   - Zmień `getProducts()` na `fetch` z `{ next: { revalidate: 300 } }` (lub `unstable_cache`).
   - Ustaw `getWordpressMenuItems()` z revalidate (np. 300) zamiast `no-cache`.
   - Podnieś revalidate dla wpisów (np. 60–300).

3. Strona główna:

   - Pobierz `products` tylko raz (w page) i użyj w `ProductsSection`.
   - Rozważ `export const revalidate = 300` dla strony głównej.

4. Obrazy i priorytety:

   - Zostaw `priority` tylko w `HeroSection`.
   - Usuń `priority` z `AboutSection` i uzupełnij `sizes` tam, gdzie brakuje.

5. Hydracja i koszt JS:

   - Lazy-load `BlogSection` (dynamic import, bez SSR) lub odroczenie renderu.
   - Zachowaj animacje, ale nie nad „foldem” jeśli nie są krytyczne.

6. Drobne:
   - Middleware pozostawić (niski koszt), ale monitorować wpływ.

## Ryzyka / kompromisy

- Wyszukiwanie „on demand” może mieć minimalne opóźnienie przy pierwszym otwarciu – rekompensowane dużym zyskiem na TTFB.
- Dłuższe revalidate oznacza wolniejsze odświeżanie treści (akceptowalne dla list produktów/blogów).

## Krytyczna ocena wg KISS/YAGNI/SRP/DRY

- KISS: eliminujemy duplikaty i ciężkie wywołania w layoutcie; proste API do wyszukiwania.
- YAGNI: nie budujemy pełnej indeksacji ani cache rozproszonego – wystarczy ISR.
- SRP: layout odpowiada tylko za szkielet; data-fecthing produktów pozostaje w miejscach, gdzie dane są wyświetlane.
- DRY: usunięcie podwójnego `getProducts()` (layout + home).
